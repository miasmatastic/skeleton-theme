{% liquid
  assign selected_collection = collections[section.settings.collection]
  assign products_limit = section.settings.products_limit | default: 12
  assign columns_desktop = section.settings.columns_desktop | default: 3
  assign columns_mobile = section.settings.columns_mobile | default: 2
  assign card_background_style = section.settings.card_background_style | default: 'solid-color'
  assign enable_quick_add = section.settings.enable_quick_add | default: true
  assign show_vendor = section.settings.show_vendor | default: false
  assign show_rating = section.settings.show_rating | default: false
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<div
  class="
    section
    section--{{ section.settings.section_width }}
    color-{{ section.settings.color_scheme }}
    dynamic-product-grid
    spacing-style
    gap-style
  "
  style="
    {% render 'spacing-style', settings: section.settings %}
    {% render 'gap-style', value: section.settings.gap %}
    --columns-desktop: {{ columns_desktop }};
    --columns-mobile: {{ columns_mobile }};
    --card-gap: {{ section.settings.card_gap | default: 16 }}px;
  "
  data-section-id="{{ section.id }}"
  data-section-type="dynamic-product-grid"
>
  <!-- Section Header -->
  <div class="dynamic-product-grid__header">
    {%- content_for 'blocks' -%}
  </div>

  <!-- Product Grid -->
  {% if selected_collection != blank and selected_collection.products.size > 0 %}
    <div 
      class="dynamic-product-grid__container{% if selected_collection.products.size > products_limit %} dynamic-product-grid--carousel{% endif %}"
      data-products-count="{{ selected_collection.products.size }}"
      data-products-limit="{{ products_limit }}"
    >
      <div class="dynamic-product-grid__grid" 
           id="ProductGrid-{{ section.id }}"
           role="region"
           aria-label="Product grid"
           aria-describedby="grid-description-{{ section.id }}">
        <div id="grid-description-{{ section.id }}" class="sr-only">
          Use arrow keys to navigate between products
        </div>
        {% for product in selected_collection.products limit: products_limit %}
          <div class="dynamic-product-grid__item">
            {% render 'card-product-dynamic',
              product: product,
              section_settings: section.settings,
              card_background_style: card_background_style,
              enable_quick_add: enable_quick_add,
              show_vendor: show_vendor,
              show_rating: show_rating,
              badge_1_text: section.settings.badge_1_text,
              badge_1_bg: section.settings.badge_1_bg_color,
              badge_1_text_color: section.settings.badge_1_text_color,
              badge_2_text: section.settings.badge_2_text,
              badge_2_bg: section.settings.badge_2_bg_color,
              badge_2_text_color: section.settings.badge_2_text_color,
              badge_3_text: section.settings.badge_3_text,
              badge_3_bg: section.settings.badge_3_bg_color,
              badge_3_text_color: section.settings.badge_3_text_color,
              section_id: section.id,
              forloop: forloop
            %}
          </div>
        {% endfor %}
      </div>
      
      <!-- Carousel Controls (if needed) -->
      {% if selected_collection.products.size > products_limit %}
        <div class="dynamic-product-grid__carousel-controls">
          <button class="carousel-btn carousel-btn--prev" data-carousel-direction="prev" aria-label="Previous products">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="carousel-btn carousel-btn--next" data-carousel-direction="next" aria-label="Next products">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  {% else %}
    <div class="dynamic-product-grid__placeholder">
      <div class="placeholder-content">
        {% if selected_collection == blank %}
          <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
            <rect x="8" y="8" width="48" height="48" rx="4" stroke="currentColor" stroke-width="2"/>
            <path d="M20 24H44M20 32H44M20 40H36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h3>No collection selected</h3>
          <p>Select a collection in the section settings to display products.</p>
        {% else %}
          <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
            <rect x="8" y="8" width="48" height="48" rx="4" stroke="currentColor" stroke-width="2"/>
            <circle cx="32" cy="26" r="6" stroke="currentColor" stroke-width="2"/>
            <path d="M16 44L24 36L32 44L40 36L48 44" stroke="currentColor" stroke-width="2"/>
          </svg>
          <h3>No products found</h3>
          <p>The "{{ selected_collection.title }}" collection is empty. Add products to see them here.</p>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>

<!-- Dynamic Product Grid JavaScript -->
<script>
  class DynamicProductGrid extends HTMLElement {
    constructor() {
      super();
      this.grid = this.querySelector('.dynamic-product-grid__grid');
      this.carouselBtns = this.querySelectorAll('.carousel-btn');
      this.currentSlide = 0;
      this.productsPerPage = parseInt(this.dataset.productsLimit);
      this.totalProducts = parseInt(this.dataset.productsCount);
      
      this.init();
    }
    
    init() {
      this.setupQuickAdd();
      this.setupCarousel();
      this.setupKeyboardNavigation();
      this.announceChanges();
    }
    
    setupQuickAdd() {
      this.addEventListener('click', (e) => {
        const quickAddBtn = e.target.closest('.quick-add-btn');
        if (quickAddBtn && !quickAddBtn.disabled) {
          e.preventDefault();
          this.handleQuickAdd(quickAddBtn);
        }
      });
    }

    setupKeyboardNavigation() {
      this.carouselBtns.forEach(btn => {
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });
      });

      // Arrow key navigation for grid items
      this.addEventListener('keydown', (e) => {
        if (e.target.closest('.dynamic-product-grid__item')) {
          this.handleArrowNavigation(e);
        }
      });
    }

    /**
     * Handles arrow key navigation within the product grid
     * Supports up/down/left/right arrow keys for accessibility
     * @param {KeyboardEvent} e - The keyboard event
     */
    handleArrowNavigation(e) {
      const items = Array.from(this.querySelectorAll('.dynamic-product-grid__item [href], .dynamic-product-grid__item button'));
      const currentIndex = items.indexOf(e.target);
      let newIndex = currentIndex;

      switch (e.key) {
        case 'ArrowRight':
          newIndex = Math.min(currentIndex + 1, items.length - 1);
          break;
        case 'ArrowLeft':
          newIndex = Math.max(currentIndex - 1, 0);
          break;
        case 'ArrowDown':
          // Move to item below (assuming grid layout)
          const itemsPerRow = parseInt(getComputedStyle(this.grid).getPropertyValue('--columns-desktop')) || 4;
          newIndex = Math.min(currentIndex + itemsPerRow, items.length - 1);
          break;
        case 'ArrowUp':
          const itemsPerRowUp = parseInt(getComputedStyle(this.grid).getPropertyValue('--columns-desktop')) || 4;
          newIndex = Math.max(currentIndex - itemsPerRowUp, 0);
          break;
        default:
          return;
      }

      if (newIndex !== currentIndex) {
        e.preventDefault();
        items[newIndex].focus();
      }
    }

    announceChanges() {
      // Create live region for screen readers
      if (!this.liveRegion) {
        this.liveRegion = document.createElement('div');
        this.liveRegion.setAttribute('aria-live', 'polite');
        this.liveRegion.setAttribute('aria-atomic', 'true');
        this.liveRegion.className = 'sr-only';
        this.appendChild(this.liveRegion);
      }
    }

    announceToScreenReader(message) {
      if (this.liveRegion) {
        this.liveRegion.textContent = message;
      }
    }
    
    /**
     * Handles quick add to cart functionality
     * @param {HTMLElement} button - The quick add button that was clicked
     * @returns {Promise<void>}
     */
    async handleQuickAdd(button) {
      const productId = button.dataset.productId;
      const variantId = button.dataset.variantId;
      
      if (!variantId) {
        // Product has variants, open quick view or redirect to product page
        window.location.href = button.dataset.productUrl;
        return;
      }
      
      button.disabled = true;
      button.classList.add('loading');
      
      try {
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1
          })
        });
        
        if (response.ok) {
          // Success - update cart and show notification
          button.textContent = 'Added!';
          this.dispatchEvent(new CustomEvent('cart:updated', {
            bubbles: true,
            detail: { variantId, quantity: 1 }
          }));
          
          // Reset button after 2 seconds
          setTimeout(() => {
            button.textContent = button.dataset.originalText;
            button.disabled = false;
            button.classList.remove('loading');
          }, 2000);
        } else {
          throw new Error('Failed to add to cart');
        }
      } catch (error) {
        console.error('Quick add error:', error);
        button.textContent = 'Error';
        button.disabled = false;
        button.classList.remove('loading');
        
        setTimeout(() => {
          button.textContent = button.dataset.originalText;
        }, 2000);
      }
    }
    
    /**
     * Sets up carousel functionality including button event listeners and touch support
     * Enables horizontal scrolling through product grid on mobile and desktop
     */
    setupCarousel() {
      if (this.carouselBtns.length === 0) return;
      
      // Set initial ARIA states
      this.updateCarouselAria();
      
      this.carouselBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const direction = btn.dataset.carouselDirection;
          this.moveCarousel(direction);
        });
      });
      
      // Touch/swipe support for mobile
      let startX = 0;
      let currentX = 0;
      let isDragging = false;
      
      this.grid.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isDragging = true;
      });
      
      this.grid.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        currentX = e.touches[0].clientX;
      });
      
      this.grid.addEventListener('touchend', () => {
        if (!isDragging) return;
        isDragging = false;
        
        const diff = startX - currentX;
        // Improved touch sensitivity for better mobile UX
        if (Math.abs(diff) > 30) {
          if (diff > 0) {
            this.moveCarousel('next');
          } else {
            this.moveCarousel('prev');
          }
        }
      });
    }
    
    /**
     * Moves the carousel in the specified direction
     * Updates button states and announces changes to screen readers
     * @param {string} direction - Either 'next' or 'prev'
     */
    moveCarousel(direction) {
      const maxSlides = Math.ceil(this.totalProducts / this.productsPerPage) - 1;
      
      if (direction === 'next' && this.currentSlide < maxSlides) {
        this.currentSlide++;
      } else if (direction === 'prev' && this.currentSlide > 0) {
        this.currentSlide--;
      }
      
      const translateX = -(this.currentSlide * 100);
      this.grid.style.transform = `translateX(${translateX}%)`;
      
      // Update button states and ARIA
      this.updateCarouselAria();
      
      // Announce change to screen readers
      const currentPage = this.currentSlide + 1;
      const totalPages = maxSlides + 1;
      this.announceToScreenReader(`Showing page ${currentPage} of ${totalPages}`);
    }

    /**
     * Updates ARIA attributes and button states for accessibility
     * Called after carousel movement to maintain proper screen reader support
     */
    updateCarouselAria() {
      const maxSlides = Math.ceil(this.totalProducts / this.productsPerPage) - 1;
      const prevBtn = this.querySelector('.carousel-btn--prev');
      const nextBtn = this.querySelector('.carousel-btn--next');
      
      if (prevBtn) {
        prevBtn.disabled = this.currentSlide === 0;
        prevBtn.setAttribute('aria-pressed', 'false');
        prevBtn.setAttribute('tabindex', this.currentSlide === 0 ? '-1' : '0');
      }
      
      if (nextBtn) {
        nextBtn.disabled = this.currentSlide === maxSlides;
        nextBtn.setAttribute('aria-pressed', 'false'); 
        nextBtn.setAttribute('tabindex', this.currentSlide === maxSlides ? '-1' : '0');
      }

      // Update grid ARIA attributes
      const currentPage = this.currentSlide + 1;
      const totalPages = maxSlides + 1;
      this.grid.setAttribute('aria-label', `Product grid, page ${currentPage} of ${totalPages}`);
    }
  }
  
  customElements.define('dynamic-product-grid', DynamicProductGrid);
  
  // Initialize the grid
  document.addEventListener('DOMContentLoaded', () => {
    const gridElement = document.querySelector('[data-section-type="dynamic-product-grid"]');
    if (gridElement) {
      gridElement.outerHTML = `<dynamic-product-grid ${gridElement.getAttributeNames().map(name => `${name}="${gridElement.getAttribute(name)}"`).join(' ')}>${gridElement.innerHTML}</dynamic-product-grid>`;
    }
  });
</script>

{% stylesheet %}
  .dynamic-product-grid {
    --grid-gap: var(--card-gap, 16px);
  }
  
  .dynamic-product-grid__header {
    margin-bottom: var(--grid-gap);
  }
  
  .dynamic-product-grid__container {
    position: relative;
  }
  
  .dynamic-product-grid__grid {
    display: grid;
    grid-template-columns: repeat(var(--columns-desktop), 1fr);
    gap: var(--grid-gap);
    transition: transform 0.3s ease;
  }
  
  .dynamic-product-grid--carousel .dynamic-product-grid__grid {
    display: flex;
    overflow: hidden;
  }
  
  .dynamic-product-grid--carousel .dynamic-product-grid__item {
    flex: 0 0 calc(100% / var(--columns-desktop));
    padding-right: var(--grid-gap);
  }
  
  .dynamic-product-grid__carousel-controls {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
    z-index: 2;
  }
  
  .carousel-btn {
    pointer-events: all;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .carousel-btn:hover {
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .carousel-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .carousel-btn--prev {
    left: -24px;
  }
  
  .carousel-btn--next {
    right: -24px;
  }
  
  .dynamic-product-grid__placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 400px;
    color: rgba(var(--color-foreground), 0.6);
  }
  
  .placeholder-content {
    text-align: center;
  }
  
  .placeholder-content svg {
    margin-bottom: 16px;
    opacity: 0.5;
  }
  
  .placeholder-content h3 {
    margin: 0 0 8px 0;
    font-size: 1.2em;
  }
  
  .placeholder-content p {
    margin: 0;
    opacity: 0.8;
  }

  /* Accessibility */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Focus styles */
  .dynamic-product-grid__item:focus-within {
    outline: 2px solid var(--color-accent, #007bff);
    outline-offset: 2px;
  }

  .carousel-btn:focus {
    outline: 2px solid var(--color-accent, #007bff);
    outline-offset: 2px;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .carousel-btn {
      border: 2px solid currentColor;
    }
    
    .dynamic-product-grid__item {
      border: 1px solid currentColor;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .dynamic-product-grid__grid {
      transition: none;
    }
    
    .carousel-btn {
      transition: none;
    }
  }
  
  /* Mobile Responsive */
  @media screen and (max-width: 768px) {
    .dynamic-product-grid__grid {
      grid-template-columns: repeat(var(--columns-mobile), 1fr);
      gap: var(--spacing-md, 1rem);
    }
    
    .dynamic-product-grid--carousel .dynamic-product-grid__item {
      flex: 0 0 calc(100% / var(--columns-mobile));
    }
    
    .carousel-btn {
      width: 44px;
      height: 44px;
      /* Larger touch targets for better mobile UX */
    }
    
    .carousel-btn--prev {
      left: -22px;
    }
    
    .carousel-btn--next {
      right: -22px;
    }

    /* Better mobile spacing */
    .dynamic-product-grid__header {
      margin-bottom: var(--spacing-lg, 1.5rem);
    }

    /* Touch-friendly quick add buttons */
    .quick-add-btn {
      min-height: 44px;
      font-size: 0.9rem;
    }
  }
  
  @media screen and (max-width: 480px) {
    .dynamic-product-grid__grid {
      gap: calc(var(--grid-gap) * 0.75);
    }
    
    .carousel-btn {
      width: 36px;
      height: 36px;
    }
    
    .carousel-btn svg {
      width: 18px;
      height: 18px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.dynamic_product_grid",
  "class": "dynamic-product-grid-section",
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    },
    {
      "type": "text"
    },
    {
      "type": "icon"
    },
    {
      "type": "image"
    },
    {
      "type": "button"
    },
    {
      "type": "video"
    },
    {
      "type": "group"
    },
    {
      "type": "spacer"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Data Source"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "t:labels.collection_to_showcase",
      "info": "Select the collection to display products from"
    },
    {
      "type": "range",
      "id": "products_limit",
      "label": "t:labels.number_of_products",
      "min": 2,
      "max": 50,
      "step": 1,
      "default": 12
    },
    {
      "type": "header",
      "content": "Layout & Display"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Desktop Columns",
      "options": [
        {
          "value": "2",
          "label": "2 Columns"
        },
        {
          "value": "3",
          "label": "3 Columns"
        },
        {
          "value": "4",
          "label": "4 Columns"
        },
        {
          "value": "5",
          "label": "5 Columns"
        }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Mobile Columns",
      "options": [
        {
          "value": "1",
          "label": "1 Column"
        },
        {
          "value": "2",
          "label": "2 Columns"
        }
      ],
      "default": "2"
    },
    {
      "type": "select",
      "id": "card_background_style",
      "label": "Card Background Style",
      "options": [
        {
          "value": "solid-color",
          "label": "Solid Color"
        },
        {
          "value": "full-bleed-image",
          "label": "Full Bleed Image"
        }
      ],
      "default": "solid-color"
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "t:labels.card_spacing",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "t:labels.product_display_options"
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "label": "t:labels.enable_quick_add",
      "default": true,
      "info": "Show quick add button on product cards"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "t:labels.show_vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "t:labels.show_rating",
      "default": false
    },
    {
      "type": "header",
      "content": "t:labels.badge_customization"
    },
    {
      "type": "text",
      "id": "badge_1_text",
      "label": "Badge 1 Text",
      "placeholder": "e.g. New!"
    },
    {
      "type": "color",
      "id": "badge_1_bg_color",
      "label": "Badge 1 Background",
      "default": "#ff6b6b"
    },
    {
      "type": "color",
      "id": "badge_1_text_color",
      "label": "Badge 1 Text Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "badge_2_text",
      "label": "Badge 2 Text",
      "placeholder": "e.g. Best Seller"
    },
    {
      "type": "color",
      "id": "badge_2_bg_color",
      "label": "Badge 2 Background",
      "default": "#4ecdc4"
    },
    {
      "type": "color",
      "id": "badge_2_text_color",
      "label": "Badge 2 Text Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "badge_3_text",
      "label": "Badge 3 Text",
      "placeholder": "e.g. Save 30%"
    },
    {
      "type": "color",
      "id": "badge_3_bg_color",
      "label": "Badge 3 Background",
      "default": "#ffa726"
    },
    {
      "type": "color",
      "id": "badge_3_text_color",
      "label": "Badge 3 Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "üñºÔ∏è Badge Image Overlays"
    },
    {
      "type": "paragraph",
      "content": "Add custom image badges that overlay on product cards based on conditions."
    },
    {
      "type": "image_picker",
      "id": "badge_image_sale",
      "label": "Sale Badge Image",
      "info": "Shows on products with compare_at_price"
    },
    {
      "type": "select",
      "id": "badge_image_sale_size",
      "label": "Sale Badge Size",
      "options": [
        { "value": "small", "label": "Small (24px)" },
        { "value": "medium", "label": "Medium (32px)" },
        { "value": "large", "label": "Large (48px)" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "badge_image_sale_position",
      "label": "Sale Badge Position",
      "options": [
        { "value": "top-left", "label": "Top Left" },
        { "value": "top-right", "label": "Top Right" },
        { "value": "bottom-left", "label": "Bottom Left" },
        { "value": "bottom-right", "label": "Bottom Right" }
      ],
      "default": "top-right"
    },
    {
      "type": "image_picker",
      "id": "badge_image_new",
      "label": "New Product Badge Image",
      "info": "Shows on products created within specified days"
    },
    {
      "type": "select",
      "id": "badge_image_new_size",
      "label": "New Badge Size",
      "options": [
        { "value": "small", "label": "Small (24px)" },
        { "value": "medium", "label": "Medium (32px)" },
        { "value": "large", "label": "Large (48px)" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "badge_image_new_position",
      "label": "New Badge Position",
      "options": [
        { "value": "top-left", "label": "Top Left" },
        { "value": "top-right", "label": "Top Right" },
        { "value": "bottom-left", "label": "Bottom Left" },
        { "value": "bottom-right", "label": "Bottom Right" }
      ],
      "default": "top-left"
    },
    {
      "type": "range",
      "id": "badge_image_new_days",
      "label": "New Product Days",
      "min": 7,
      "max": 90,
      "step": 1,
      "default": 30,
      "info": "Days since creation to consider product 'new'"
    },
    {
      "type": "image_picker",
      "id": "badge_image_featured",
      "label": "Featured Product Badge Image",
      "info": "Shows on products tagged 'featured' or with featured metafield"
    },
    {
      "type": "select",
      "id": "badge_image_featured_size",
      "label": "Featured Badge Size",
      "options": [
        { "value": "small", "label": "Small (24px)" },
        { "value": "medium", "label": "Medium (32px)" },
        { "value": "large", "label": "Large (48px)" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "badge_image_featured_position",
      "label": "Featured Badge Position",
      "options": [
        { "value": "top-left", "label": "Top Left" },
        { "value": "top-right", "label": "Top Right" },
        { "value": "bottom-left", "label": "Bottom Left" },
        { "value": "bottom-right", "label": "Bottom Right" }
      ],
      "default": "bottom-right"
    },
    {
      "type": "image_picker",
      "id": "badge_image_custom",
      "label": "Custom Badge Image",
      "info": "Always shows when image is selected"
    },
    {
      "type": "select",
      "id": "badge_image_custom_size",
      "label": "Custom Badge Size",
      "options": [
        { "value": "small", "label": "Small (24px)" },
        { "value": "medium", "label": "Medium (32px)" },
        { "value": "large", "label": "Large (48px)" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "badge_image_custom_position",
      "label": "Custom Badge Position",
      "options": [
        { "value": "top-left", "label": "Top Left" },
        { "value": "top-right", "label": "Top Right" },
        { "value": "bottom-left", "label": "Bottom Left" },
        { "value": "bottom-right", "label": "Bottom Right" },
        { "value": "center", "label": "Center" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Section Layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page Width"
        },
        {
          "value": "full-width",
          "label": "Full Width"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Section Gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color Scheme",
      "options": [
        { "value": "scheme-1", "label": "Light" },
        { "value": "scheme-2", "label": "Neutral" },
        { "value": "scheme-3", "label": "Dark" }
      ],
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    }
  ],
  "presets": [
    {
      "name": "Conversion Spotlight",
      "category": "Products",
      "settings": {
        "columns_desktop": "3",
        "columns_mobile": "2",
        "card_background_style": "solid-color",
        "enable_quick_add": true,
        "products_limit": 9,
        "badge_1_text": "New!",
        "badge_1_bg_color": "#ff6b6b",
        "badge_1_text_color": "#ffffff",
        "badge_2_text": "Holiday Exclusive",
        "badge_2_bg_color": "#4ecdc4",
        "badge_2_text_color": "#ffffff",
        "card_gap": 20,
        "color_scheme": "scheme-1",
        "section_width": "page-width",
        "padding-block-start": 60,
        "padding-block-end": 60
      },
      "blocks": {
        "header_group": {
          "type": "group",
          "name": "Header",
          "settings": {
            "content_direction": "column",
            "horizontal_alignment": "center",
            "vertical_alignment": "center",
            "gap": 16,
            "padding-block-end": 32
          },
          "blocks": {
            "title": {
              "type": "text",
              "settings": {
                "text": "<h2>Featured Products</h2>",
                "alignment": "center",
                "type_preset": "h2"
              }
            }
          },
          "block_order": ["title"]
        }
      },
      "block_order": ["header_group"]
    },
    {
      "name": "Cinematic Carousel",
      "category": "Products",
      "settings": {
        "columns_desktop": "4",
        "columns_mobile": "1",
        "card_background_style": "full-bleed-image",
        "enable_quick_add": false,
        "products_limit": 16,
        "badge_1_text": "",
        "badge_2_text": "",
        "badge_3_text": "",
        "card_gap": 24,
        "color_scheme": "scheme-1",
        "section_width": "full-width",
        "padding-block-start": 80,
        "padding-block-end": 80
      },
      "blocks": {
        "header_group": {
          "type": "group",
          "name": "Header",
          "settings": {
            "content_direction": "column",
            "horizontal_alignment": "center",
            "vertical_alignment": "center",
            "gap": 20,
            "padding-block-end": 48
          },
          "blocks": {
            "title": {
              "type": "text",
              "settings": {
                "text": "<h1>EARLY HOLIDAY DEALS</h1>",
                "alignment": "center",
                "type_preset": "h1",
                "case": "uppercase"
              }
            }
          },
          "block_order": ["title"]
        }
      },
      "block_order": ["header_group"]
    },
    {
      "name": "Editorial Focus",
      "category": "Products",
      "settings": {
        "columns_desktop": "2",
        "columns_mobile": "1",
        "card_background_style": "solid-color",
        "enable_quick_add": false,
        "products_limit": 6,
        "badge_1_text": "",
        "badge_2_text": "",
        "badge_3_text": "",
        "card_gap": 32,
        "color_scheme": "scheme-1",
        "section_width": "page-width",
        "padding-block-start": 60,
        "padding-block-end": 60
      },
      "blocks": {
        "header_group": {
          "type": "group",
          "name": "Header",
          "settings": {
            "content_direction": "column",
            "horizontal_alignment": "flex-start",
            "vertical_alignment": "center",
            "gap": 12,
            "padding-block-end": 40
          },
          "blocks": {
            "title": {
              "type": "text",
              "settings": {
                "text": "<h2>Curated Collection</h2>",
                "alignment": "left",
                "type_preset": "h2"
              }
            }
          },
          "block_order": ["title"]
        }
      },
      "block_order": ["header_group"]
    },
    {
      "name": "Essential Showcase",
      "category": "Products",
      "settings": {
        "columns_desktop": "3",
        "columns_mobile": "2",
        "card_background_style": "full-bleed-image",
        "enable_quick_add": true,
        "products_limit": 12,
        "badge_1_text": "",
        "badge_2_text": "",
        "badge_3_text": "",
        "card_gap": 16,
        "color_scheme": "scheme-1",
        "section_width": "page-width",
        "padding-block-start": 48,
        "padding-block-end": 48
      },
      "blocks": {
        "header_group": {
          "type": "group",
          "name": "Header",
          "settings": {
            "content_direction": "column",
            "horizontal_alignment": "center",
            "vertical_alignment": "center",
            "gap": 16,
            "padding-block-end": 32
          },
          "blocks": {
            "title": {
              "type": "text",
              "settings": {
                "text": "<h2>Shop Our Essentials</h2>",
                "alignment": "center",
                "type_preset": "h2"
              }
            }
          },
          "block_order": ["title"]
        }
      },
      "block_order": ["header_group"]
    }
  ]
}
{% endschema %}